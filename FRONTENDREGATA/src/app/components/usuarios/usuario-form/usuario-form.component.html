<div class="usuario-form">
  <div class="header">
    <h2>{{ isEditMode() ? 'Editar Usuario' : 'Crear Nuevo Usuario' }}</h2>
  </div>

  @if (loading()) {
    <div class="loading">Cargando datos...</div>
  }

  @if (error()) {
    <div class="error">{{ error() }}</div>
  }

  <form (ngSubmit)="saveUsuario()" #usuarioForm="ngForm">
    <div class="form-group">
      <label for="nombre">Nombre *</label>
      <input 
        type="text" 
        id="nombre"
        name="nombre"
        #nombre="ngModel"
        [(ngModel)]="usuario().nombre"
        required
        minlength="2"
        maxlength="50"
        class="form-control"
        placeholder="Ingresa el nombre del usuario">
      @if (nombre.invalid && nombre.touched) {
        <div class="field-error">El nombre debe tener entre 2 y 50 caracteres y no puede estar vacío</div>
      }
    </div>

    <div class="form-group">
      <label for="email">Email *</label>
      <input 
        type="email" 
        id="email"
        name="email"
        #email="ngModel"
        [(ngModel)]="usuario().email"
        required
        email
        class="form-control"
        placeholder="Ingresa el email del usuario">
      @if (email.invalid && email.touched) {
        <div class="field-error">
          @if (email.errors?.['required']) {
            El email es obligatorio
          } @else if (email.errors?.['email']) {
            El email debe ser válido
          }
        </div>
      }
    </div>

    <div class="form-group">
      <label for="password">
        Contraseña 
        @if (!isEditMode()) {
          *
        } @else {
          (opcional - deja vacío para mantener la actual)
        }
      </label>
      <input 
        type="password" 
        id="password"
        name="password"
        #password="ngModel"
        [(ngModel)]="usuario().password"
        [required]="!isEditMode()"
        minlength="6"
        class="form-control"
        [placeholder]="isEditMode() ? 'Deja vacío para mantener la contraseña actual' : 'Ingresa la contraseña'">
      @if (password.invalid && password.touched) {
        <div class="field-error">
          @if (password.errors?.['required']) {
            La contraseña es obligatoria
          } @else if (password.errors?.['minlength']) {
            La contraseña debe tener al menos 6 caracteres
          }
        </div>
      }
    </div>

    <div class="form-group">
      <label for="rol">Rol *</label>
      <select 
        id="rol"
        name="rol"
        #rol="ngModel"
        [(ngModel)]="usuario().rol"
        required
        class="form-control">
        <option value="">Selecciona un rol</option>
        <option value="JUGADOR">Jugador</option>
        <option value="ADMIN">Administrador</option>
      </select>
      @if (rol.invalid && rol.touched) {
        <div class="field-error">Debe seleccionar un rol</div>
      }
    </div>

    <div class="form-actions">
      <button 
        type="button" 
        class="btn btn-secondary"
        (click)="usuarioForm.resetForm()">
        Limpiar
      </button>
      <button 
        type="submit" 
        class="btn btn-primary"
        [disabled]="saving() || usuarioForm.invalid">
        @if (saving()) {
          Guardando...
        } @else {
          {{ isEditMode() ? 'Actualizar' : 'Crear' }} Usuario
        }
      </button>
    </div>
  </form>
</div>